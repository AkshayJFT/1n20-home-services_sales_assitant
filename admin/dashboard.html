<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - PDF Presentation System</title>
    <link rel="stylesheet" href="/admin/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-cog"></i>
                <span>Admin Panel</span>
            </div>

            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" data-page="products">
                    <i class="fas fa-box"></i>
                    <span>Products</span>
                </li>
                <li class="nav-item" data-page="content">
                    <i class="fas fa-file-alt"></i>
                    <span>Content Manager</span>
                </li>
                <li class="nav-item" data-page="users">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </li>
                <li class="nav-item" data-page="analytics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Analytics</span>
                </li>
                <li class="nav-item" data-page="settings">
                    <i class="fas fa-sliders-h"></i>
                    <span>Settings</span>
                </li>
            </ul>

            <div class="sidebar-footer">
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <h1 id="pageTitle">Dashboard</h1>
                <div class="user-info">
                    <span id="adminName">Admin</span>
                    <i class="fas fa-user-circle"></i>
                </div>
            </header>

            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon users">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalUsers">0</h3>
                            <p>Total Users</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon chats">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalChats">0</h3>
                            <p>Total Chats</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon today">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="usersToday">0</h3>
                            <p>Users Today</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon presentations">
                            <i class="fas fa-play-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="presentationStarts">0</h3>
                            <p>Presentations</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card recent-activity">
                        <h3><i class="fas fa-clock"></i> Recent Activity</h3>
                        <ul id="recentActivity" class="activity-list">
                            <!-- Populated by JS -->
                        </ul>
                    </div>
                    <div class="card quick-actions">
                        <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                        <div class="action-buttons">
                            <button onclick="showPage('products')" class="action-btn">
                                <i class="fas fa-plus"></i>
                                Add New Product
                            </button>
                            <button onclick="showPage('content')" class="action-btn">
                                <i class="fas fa-edit"></i>
                                Edit Content
                            </button>
                            <button onclick="showPage('settings')" class="action-btn">
                                <i class="fas fa-cog"></i>
                                Settings
                            </button>
                            <button onclick="window.open('/', '_blank')" class="action-btn">
                                <i class="fas fa-external-link-alt"></i>
                                View Frontend
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Page -->
            <div id="productsPage" class="page">
                <div class="products-header">
                    <h3><i class="fas fa-box"></i> Products</h3>
                    <button class="btn-primary" onclick="showAddProductModal()">
                        <i class="fas fa-plus"></i> Add Product
                    </button>
                </div>

                <div class="products-grid" id="productsGrid">
                    <!-- Populated by JS -->
                </div>

                <!-- Add Product Modal -->
                <div id="addProductModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3><i class="fas fa-plus"></i> Add New Product</h3>
                            <button onclick="closeAddProductModal()" class="close-btn">&times;</button>
                        </div>
                        <form id="addProductForm" class="modal-body">
                            <div class="form-group">
                                <label>Product Name</label>
                                <input type="text" id="productName" required placeholder="e.g., Windows, Doors">
                            </div>
                            <div class="form-group">
                                <label>Slug (URL-friendly name)</label>
                                <input type="text" id="productSlug" required placeholder="e.g., windows, doors">
                            </div>
                            <div class="form-group">
                                <label>Description (optional)</label>
                                <textarea id="productDescription" placeholder="Brief description..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Upload PDF</label>
                                <div class="upload-zone small" id="productUploadZone">
                                    <i class="fas fa-file-pdf"></i>
                                    <p>Click to select PDF</p>
                                    <input type="file" id="productPdfInput" accept=".pdf" style="display: none;">
                                </div>
                                <p id="selectedFileName" class="text-muted"></p>
                            </div>
                            <div id="productUploadProgress" class="upload-progress" style="display: none;">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="productProgressFill"></div>
                                </div>
                                <p id="productUploadStatus">Processing...</p>
                            </div>
                            <button type="submit" class="btn-primary" style="width: 100%;">
                                <i class="fas fa-upload"></i> Create Product
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Content Manager Page -->
            <div id="contentPage" class="page">
                <!-- Product Selector -->
                <div class="content-header">
                    <label>Select Product:</label>
                    <select id="contentProductSelect" onchange="loadProductContent()">
                        <option value="">-- Select a product --</option>
                    </select>
                </div>

                <div class="content-tabs">
                    <button class="tab-btn" data-tab="pdf">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="tab-btn active" data-tab="presentation">
                        <i class="fas fa-tv"></i> Presentation JSON
                    </button>
                    <button class="tab-btn" data-tab="analysis">
                        <i class="fas fa-search"></i> Analysis JSON
                    </button>
                    <button class="tab-btn" data-tab="images">
                        <i class="fas fa-images"></i> Images
                    </button>
                </div>

                <div id="pdfTab" class="tab-content">
                    <div class="pdf-viewer-container">
                        <div id="pdfInfo" class="pdf-info">
                            <p class="text-muted">Select a product to view its PDF</p>
                        </div>
                        <div id="pdfViewer" class="pdf-viewer">
                            <!-- PDF will be embedded here -->
                        </div>
                        <!-- Upload PDF section (shown when no PDF) -->
                        <div id="pdfUploadSection" class="pdf-upload-section" style="display: none;">
                            <div class="upload-zone" id="contentPdfUploadZone">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Drop PDF here or click to upload</p>
                                <input type="file" id="contentPdfInput" accept=".pdf" style="display: none;">
                            </div>
                            <div id="contentUploadProgress" class="upload-progress" style="display: none;">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="contentProgressFill"></div>
                                </div>
                                <p id="contentUploadStatus">Uploading...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="presentationTab" class="tab-content active">
                    <div class="json-editor-container">
                        <div class="editor-toolbar">
                            <button onclick="formatJSON('presentation')" class="toolbar-btn">
                                <i class="fas fa-indent"></i> Format
                            </button>
                            <button onclick="saveProductJSON('presentation')" class="toolbar-btn primary">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </div>
                        <textarea id="presentationJSON" class="json-editor" placeholder="Select a product to view its content"></textarea>
                    </div>
                </div>

                <div id="analysisTab" class="tab-content">
                    <div class="json-editor-container">
                        <div class="editor-toolbar">
                            <button onclick="formatJSON('analysis')" class="toolbar-btn">
                                <i class="fas fa-indent"></i> Format
                            </button>
                            <button onclick="saveProductJSON('analysis')" class="toolbar-btn primary">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </div>
                        <textarea id="analysisJSON" class="json-editor" placeholder="Select a product to view its content"></textarea>
                    </div>
                </div>

                <div id="imagesTab" class="tab-content">
                    <div class="images-toolbar">
                        <span id="imageCount">0 images</span>
                        <label class="checkbox-label">
                            <input type="checkbox" id="showDeleted" onchange="loadProductImages()">
                            Show deleted
                        </label>
                    </div>
                    <div id="imagesGrid" class="images-grid">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <div id="usersPage" class="page">
                <div class="card">
                    <div class="table-header">
                        <h3><i class="fas fa-users"></i> Registered Users</h3>
                        <input type="text" id="userSearch" placeholder="Search users..." class="search-input">
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Registered</th>
                                    <th>Last Active</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Chat History Modal -->
                <div id="chatModal" class="modal" style="display: none;">
                    <div class="modal-content chat-modal">
                        <div class="modal-header">
                            <h3><i class="fas fa-comments"></i> Chat History - <span id="chatUserName"></span></h3>
                            <button onclick="closeChatModal()" class="close-btn">&times;</button>
                        </div>
                        <div id="chatHistory" class="chat-history">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Processing Modal -->
                <div id="processingModal" class="modal processing-modal" style="display: none;">
                    <div class="modal-content processing-content">
                        <div class="processing-icon">
                            <i class="fas fa-cog fa-spin"></i>
                        </div>
                        <h3 id="processingTitle">Processing PDF</h3>
                        <p id="processingMessage">This may take a few minutes. Please don't close this page.</p>
                        <div class="processing-progress">
                            <div class="progress-bar">
                                <div id="processingProgressFill" class="progress-fill" style="width: 0%"></div>
                            </div>
                            <span id="processingStage">Initializing...</span>
                        </div>
                        <div id="processingResult" class="processing-result" style="display: none;">
                            <i class="fas fa-check-circle success-icon"></i>
                            <p>Processing complete!</p>
                            <button onclick="closeProcessingModal()" class="btn btn-primary">Done</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analyticsPage" class="page">
                <div class="stats-grid">
                    <div class="stat-card large">
                        <h4>User Growth (Last 7 Days)</h4>
                        <div id="userGrowthChart" class="chart-placeholder">
                            <!-- Simple bar chart will be rendered here -->
                        </div>
                    </div>
                    <div class="stat-card large">
                        <h4>Daily Activity</h4>
                        <div id="activityChart" class="chart-placeholder">
                            <!-- Simple bar chart will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settingsPage" class="page">
                <div class="card settings-card">
                    <h3><i class="fas fa-sliders-h"></i> Presentation Settings</h3>
                    <p class="settings-description">These settings apply to all users viewing the presentation.</p>

                    <form id="settingsForm" class="settings-form">
                        <div class="setting-group">
                            <label for="ttsVoice">
                                <i class="fas fa-microphone"></i>
                                Voice / Tone
                            </label>
                            <select id="ttsVoice" name="tts_voice">
                                <optgroup label="Female Voices">
                                    <option value="asteria">Asteria (American, warm)</option>
                                    <option value="luna">Luna (American, soft)</option>
                                    <option value="stella">Stella (American, confident)</option>
                                    <option value="athena">Athena (British, professional)</option>
                                    <option value="hera">Hera (American, authoritative)</option>
                                </optgroup>
                                <optgroup label="Male Voices">
                                    <option value="orion">Orion (American, deep)</option>
                                    <option value="arcas">Arcas (American, energetic)</option>
                                    <option value="perseus">Perseus (American, friendly)</option>
                                    <option value="angus">Angus (Irish accent)</option>
                                    <option value="orpheus">Orpheus (American, calm)</option>
                                    <option value="helios">Helios (British, refined)</option>
                                    <option value="zeus">Zeus (American, commanding)</option>
                                </optgroup>
                            </select>
                        </div>

                        <div class="setting-group">
                            <label for="presentationSpeed">
                                <i class="fas fa-tachometer-alt"></i>
                                Playback Speed: <span id="speedValue">1x</span>
                            </label>
                            <input type="range" id="presentationSpeed" name="presentation_speed"
                                   min="0.5" max="2" step="0.1" value="1">
                        </div>

                        <div class="setting-group">
                            <label for="sectionDelay">
                                <i class="fas fa-clock"></i>
                                Section Delay
                            </label>
                            <select id="sectionDelay" name="section_delay">
                                <option value="0">No delay</option>
                                <option value="0.5">0.5 seconds</option>
                                <option value="1">1 second</option>
                                <option value="2">2 seconds</option>
                                <option value="3">3 seconds</option>
                            </select>
                        </div>

                        <div class="setting-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="ttsEnabled" name="tts_enabled" checked>
                                <span><i class="fas fa-volume-up"></i> Auto-play Voice</span>
                            </label>
                        </div>

                        <button type="submit" class="btn-primary save-settings-btn">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script src="/admin/admin.js"></script>
</body>
</html>
